# Issue

<!-- Add  Link to github issue -->

# MD runs

In the `runs` folder. 
Two example runs of 10 ps NVT trajectories at 300 K of the same system (`atom`) with the same MLP (`model.pth`))
Result still holds for 100 ps with better averaging.

In both cases, I used e3nn=0.5.1 and pytorch=1.10.1 (also tested with 1.13.0)

## ASE

Used nequip v0.5.6 (also tested with 0.5.5)

```
python3 -u ase_input.py
```

## LAMMPS

Launched from pair_nequip from the [stress branch](https://github.com/mir-group/pair_nequip/tree/stress), v 0.5.2
```
lmp -i lmp_input.in
```

# Read pressure

Both outputs are read with `results/plot_pressure.py`

## LAMMPS

It is read from in the `thermo` log data (property `Press`).

## ASE
Stress is read from the `exyz` generated by ASE as output.
For each frame, it is contained in the header (in eV/ang^3) as in the example below (three first lines)
```
272
Lattice="15.4231 0.0 0.0 0.0 15.4042 0.0 0.0 0.0 18.4379" Properties=species:S:1:pos:R:3:momenta:R:3:forces:R:3:energies:R:1 energy=-60081.71875 stress="0.0012447895715013146 -0.00012050337682012469 0.000913634488824755 -0.00012050337682012469 0.00034063911880366504 0.0013128288555890322 0.000913634488824755 0.0013128288555890322 0.00354289123788476" free_energy=-60081.71875 pbc="T T T"
C       17.05751199      10.48970996      28.94480464       1.80425394       0.32627805       0.51177082      -1.48841357       1.01981807      -0.66333652    -220.24612427
```

It is read with `atom.info['stress']` for each `atom` object in the ase trajectory.
To use the same convention than LAMMPS, it is multiplied by $(-1)$ and converted to bar.

# Results

Using the example inputs, I obtained:
```
Average pressure with LAMMPS: %s 2238.13603273185
Average pressure with ASE: %s -354.6579018371563
```

Pressure is expressed in bar.
The fluctuations are shown on `results/Pressure(step).pdf`

## Other systems

This was also observed with other MLPs, thermostat damping constants, system volumes, with a systematic shift of roughly 2000 bars as shown on
`results/Other_systems.png`.